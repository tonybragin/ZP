////  brain.c//  ZP////  Created by TONY on 07/08/2016.//  Copyright ï¿½ 2016 TONY. All rights reserved.//#include "head.h"//*****//***** load *****//*****void load_spec(){    FILE *file;        file = fopen(fspec, "r");    fscanf(file, "%s\n%c\n%d", nickname, &lang, &pay);    fclose(file);}void load_hours(char fname[]){    FILE *file;    hours_init();        file = fopen(fname, "r");        fscanf(file, "%d", &avans);    while (fscanf(file, "%d %f", &buf1, &buf2)) {        hours[buf1] = buf2;        sum += buf2;        if (buf1 <= 15) sum15 += buf2;        N++;        if (hours[0] < buf1) {            hours[0] = buf1;        }    }        fclose(file);}void load_next(){    FILE *file;        file = fopen(fnext, "r");    fscanf(file, "%d\n%f\n%f\n%f\n", &plan, &month, &week, &day);    fclose(file);}//*****//***** edit *****//*****void save_hours(char fname[]){    FILE *file;        file = fopen(fname, "w");        fprintf(file, "%d\n", avans);    for (int i = 1; i < DAYS ; i++) {        if (hours[i] > 0) {            fprintf(file, "%d %.2f\n", i, hours[i]);        }    }    fprintf(file, "END");    fclose(file);}void edit_spec(int s){    FILE *file;        file = fopen(fspec, "w");        switch (s) {        case 0: {            if (lang == 'e')                show_nick();            else show_nick_ru();            fprintf(file, "%s\n%c\n%d", nickname, lang, pay);            break;        }        case 1: {            fprintf(file, "%s\n%c\n%d", nickname, lang, pay);            break;        }        case 2: {            if (lang == 'e')                show_pay();            else show_pay_ru();            fprintf(file, "%s\n%c\n%d", nickname, lang, pay);            break;        }                }    fclose(file);}void edit_next(){    FILE *file;        if (lang == 'e')        show_plan();    else show_plan_ru();    pre_next();        file = fopen(fnext, "w");    fprintf(file, "%d\n%.2f\n%.2f\n%.2f\n", plan, month, week, day);    fclose(file);}void edit_avans(){        pthread_create(&thread, NULL, load_hours, fthis);    if (lang == 'e')        show_avans();    else show_avans_ru();    pthread_join(thread, NULL);        save_hours(fthis);}void add_hours(){    pthread_create(&thread, NULL, load_hours, fthis);    if (lang == 'e')        show_add();    else show_add_ru();    pthread_join(thread, NULL);        buf2 -= 0.5;        if (hours[buf1] == 0) {        hours[buf1] = buf2;        sum += buf2;        if (hours[0] < buf1) {            hours[0] = buf1;        }    }    else {        hours[buf1] += buf2;        sum += buf2;    }    save_hours(fthis);}void delete_hours(){    pthread_create(&thread, NULL, load_hours, fthis);    if (lang == 'e')        show_delete();    else show_delete_ru();    pthread_join(thread, NULL);        sum -= hours[buf1];    for (int i = 1; i < DAYS; i++) {        if (hours[i] > 0 && hours[0] < i) {            hours[0] = i;        }    }    hours[buf1] = 0;    save_hours(fthis);}void correct_hours(){    pthread_create(&thread, NULL, load_hours, fthis);    if (lang == 'e')        show_add();    else show_add_ru();    pthread_join(thread, NULL);        sum -= hours[buf1];    if (buf2 == 0) {        for (int i = 1; i < DAYS; i++) {            if (hours[i] > 0 && hours[0] < i) {                hours[0] = i;            }        }    }    else {        hours[buf1] = buf2;        sum += buf2;    }    save_hours(fthis);}void end_month(){    load_hours(fthis);    save_hours(fprev);        hours_init();    save_hours(fthis);}//*****//***** math//*****int pre_this(){    pre = 0;        if (hours[0] < 15) {        for (int i = 1; i < 8; i++) {            if (hours[i] > 0) {                pre += hours[i];            }        }        pre *= 4 * pay;                return 0;    }        for (int i = 1; i < 16; i++) {        if (hours[i] > 0) {            pre += hours[i];        }    }    pre *= 2 * pay;        return 0;}void pre_next(){    month = plan / pay;    week = month / 4;    day = week / 5;}void pre_mat(){    int px = 30;    int count = 0;    float sy = 0, sx = 0;    float p = 0;        for (int i = 1; i < DAYS; i++) {        if (hours[i] > 0) {            count++;            sy += p + hours[i];            sx += i;            p += hours[i];        }    }        float k = (sy / count) / (sx / count);        if (k > 0)        pre = px * k * pay;    else pre = 0;    }